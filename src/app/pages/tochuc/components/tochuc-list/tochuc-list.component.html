<div class="tochuc-list">
  <nz-card class="main-card" [nzBordered]="false">
    <!-- Header Section -->
    <div class="header-section">
      <div class="header-left">
        <div class="title-section">
          <span nz-icon nzType="apartment" nzTheme="twotone" class="title-icon"></span>
          <h1>{{ title | translate }}</h1>
        </div>
        <p class="subtitle">{{ subtitle | translate }}</p>
      </div>
      @if (showCreateButton) {
      <div class="header-actions">
        <button nz-button nzType="primary" nzSize="large" (click)="onCreateClick()">
          <span nz-icon nzType="plus"></span>
          {{ 'tochuc.actions.create' | translate }}
        </button>
      </div>
      }
    </div>

    <nz-divider></nz-divider>

    <!-- Toolbar Section -->
    <div class="toolbar-section">
      <div class="search-section">
        <app-base-tags-input
          [(tags)]="searchTags"
          [searchFields]="searchFields"
          [placeholder]="'tochuc.list.searchPlaceholder' | translate"
          [debounceTime]="500"
          [maxTags]="10"
          (tagsChange)="onSearchTagsChange($event)"
        />
      </div>
      <div class="view-switcher">
        <nz-radio-group [(ngModel)]="viewMode" (ngModelChange)="switchView($event)" nzButtonStyle="solid">
          <label nz-radio-button nzValue="table">
            <span nz-icon nzType="table"></span>
            {{ 'common.table' | translate }}
          </label>
          <label nz-radio-button nzValue="tree">
            <span nz-icon nzType="apartment"></span>
            {{ 'common.tree' | translate }}
          </label>
        </nz-radio-group>
      </div>
    </div>

    <nz-divider></nz-divider>

    <!-- Content Section -->
    <div class="content-section">
      <!-- Table View -->
      @if (viewMode === 'table') {
      <div class="table-wrapper">
        <app-base-table 
          [data]="treeTableData" 
          [columns]="displayColumns" 
          [actions]="displayActions" 
          [loading]="loading" 
          [bordered]="true"
          [scroll]="scroll" 
          [isTree]="true" 
          [showPagination]="false" 
          [virtualScroll]="true"
          [checkable]="checkable"
          [multiple]="multiple"
          [checkedKeys]="checkedKeys"
          (checkChange)="onCheckChange($event)"
        />
      </div>
      }

      <!-- Tree View -->
      @if (viewMode === 'tree') {
      <div class="tree-wrapper">
        @if (searchTags.length > 0 && filteredTreeData.length === 0) {
          <nz-empty 
            nzNotFoundImage="simple" 
            [nzNotFoundContent]="'common.notFound' | translate"
          ></nz-empty>
        } @else {
          <app-base-tree 
            [nodes]="filteredTreeData.length > 0 ? filteredTreeData : treeData" 
            [checkable]="checkable" 
            [checkedKeys]="checkedKeys"
            [showLine]="true" 
            [expandAll]="searchTags.length > 0"
            (nodeClick)="onTreeNodeClick($event)"
            (nzCheckBoxChange)="onCheckChange($event)"
          />
        }
      </div>
      }
    </div>
  </nz-card>
</div>