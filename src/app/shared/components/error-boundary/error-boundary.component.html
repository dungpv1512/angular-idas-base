<!-- Fatal Error Screen - Block toàn bộ UI -->
@if (hasFatalError()) {
  <div class="fatal-error-overlay">
    <nz-result
      nzStatus="error"
      [nzTitle]="'ERROR.FATAL.TITLE' | translate"
      [nzSubTitle]="fatalError()?.message"
    >
      <div nz-result-extra>
        @if (fatalError()?.code) {
          <p class="error-code">{{ 'ERROR.CODE' | translate }}: {{ fatalError()?.code }}</p>
        }
        @if (fatalError()?.details) {
          <p class="error-details">{{ fatalError()?.details }}</p>
        }

        <div class="error-actions">
          <button nz-button nzType="primary" (click)="onReload()">
            <span nz-icon nzType="reload"></span>
            {{ 'ERROR.ACTION.RELOAD' | translate }}
          </button>
          <button nz-button nzType="default" (click)="onGoHome()">
            <span nz-icon nzType="home"></span>
            {{ 'ERROR.ACTION.GO_HOME' | translate }}
          </button>
          <button nz-button nzType="link" (click)="onDismissAll()">
            {{ 'ERROR.ACTION.DISMISS' | translate }}
          </button>
        </div>
      </div>
    </nz-result>
  </div>
} @else {
  <!-- Normal Content -->
  <ng-content></ng-content>

  <!-- Error Notifications - Góc phải màn hình -->
  @if (hasErrors()) {
    <div class="error-notifications">
      <!-- Header với badge count -->
      <div class="notifications-header">
        <nz-badge [nzCount]="errorCount()">
          <span nz-icon nzType="warning" nzTheme="fill" class="header-icon"></span>
        </nz-badge>
        <span class="header-title">{{ 'ERROR.NOTIFICATIONS' | translate }}</span>
        <button
          nz-button
          nzType="link"
          nzSize="small"
          (click)="onDismissAll()"
          class="dismiss-all-btn"
        >
          {{ 'ERROR.ACTION.DISMISS_ALL' | translate }}
        </button>
      </div>

      <!-- Danh sách lỗi -->
      <div class="notifications-list">
        @for (error of errors(); track trackByErrorId($index, error)) {
          <nz-alert
            [nzType]="getAlertType(error.severity)"
            [nzMessage]="error.message"
            [nzDescription]="error.details ?? null"
            nzShowIcon
            nzCloseable
            (nzOnClose)="onDismiss(error)"
            class="error-alert"
          >
          </nz-alert>
        }
      </div>
    </div>
  }
}
